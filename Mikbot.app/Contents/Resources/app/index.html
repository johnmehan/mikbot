<script>
  //----------Nodejs MQTT stuff----------//
  var connected = false;

  const mqtt = require('mqtt'); //include our node library

  // Create a client connection
  var client = mqtt.createClient(17091, "m12.cloudmqtt.com", {
    username: "mikbot",
    password: "mikhailbot" 
  });

  client.on('connect', function() { // When connected
    console.log("MQTT connected!")
    connected = true;
  });

  function command(name) {
    console.log(name);
    client.publish('move', name, function() {});
  }

  //----------Arrow key stuff----------//
  up = down = left = right = false;

  //on key press
  window.addEventListener("keydown", function(e) {
    switch(event.keyCode) {
      case 37: //left
        if(!left) {
          command('L');
        }
        left = true;
        break;
      case 38: //up
        if(!up) {
          command('F');
        }
        up = true;
        break;
      case 39: //right
        if(!right) {
          command('R');
        }
        right = true;
        break;
      case 40: //down
        if(!down) {
          command('D');
        }
        down = true;
        break;
    }
  });
  
  //on key release
  window.addEventListener("keyup", function(e) {
    switch(event.keyCode) {
      case 37:
        left = false;
        break;
      case 38:
        up = false;
        break;
      case 39:
        right = false;
        break;
      case 40:
        down = false;
        break;
    }
  });

  //runs every 300ms
  setInterval(function() {
    if (left) {
      command('L');
    }
    if (up) {
      command('F');
    }
    if (right) {
      command('R');
    }
    if (down) {
      command('B');
    }
  }, 300);
</script>

<p>
  <strong>Use keyboard to navigate</strong>
</p>
<table style='width:50%;'>
  <tr>
    <td colspan='2' align='center'>
      <a onclick='command("F");' id='up'>
        <input type='image' src='images/arrow-up.png'>
      </a>
    </td>
  </tr>
  <tr>
    <td align='centr' width='50%;'>
      <a onclick='command("L");' id='left'>
        <input type='image' src='images/arrow-left.png'>
      </a>
    </td>
    <td align='center'>
      <a onclick='command("R");' id='right'>
        <input type='image' src='images/arrow-right.png'>
      </a>
    </td>
  </tr>
  <tr>
    <td colspan='2' align='center'>
      <a onclick='command("B");' id='down'>
        <input type='image' src='images/arrow-down.png'>
      </a>
    </td>
  </tr>
</table>